<!DOCTYPE html>
<html>
<head>
  <title>Employee Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .leave-balance {
      display: flex;
      justify-content: space-between;
      margin-bottom: 18px;
      background: #f7f9fb;
      padding: 14px 18px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.05);
      font-size: 16px;
      font-weight: 500;
    }
    .leave-balance span {
      margin-right: 18px;
    }
    .leave-balance .casual { color: #1976d2; }
    .leave-balance .sick { color: #e67e22; }
    .leave-balance .earned { color: #27ae60; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Welcome, {{ username }}</h2>

    <!-- Updated Leave Balance Calculation -->
    {% set ns = namespace(casual=0, sick=0, earned=0) %}
    {% for lr in leaves %}
      {% if lr.status == 'Approved' %}
        {% if lr.leave_type == 'Casual' %}
          {% set ns.casual = ns.casual + 1 %}
        {% elif lr.leave_type == 'Sick' %}
          {% set ns.sick = ns.sick + 1 %}
        {% elif lr.leave_type == 'Earned' %}
          {% set ns.earned = ns.earned + 1 %}
        {% endif %}
      {% endif %}
    {% endfor %}

    <div class="leave-balance">
      <span class="casual">Casual: {{ ns.casual }}/10</span>
      <span class="sick">Sick: {{ ns.sick }}/10</span>
      <span class="earned">Earned: {{ ns.earned }}/5</span>
    </div>

    <!-- Leave Submission Form -->
    <form method="POST">
      <h3>Submit Leave</h3>
      <label>From</label>
      <input type="date" name="from" required min="{{ today }}">
      <label>To</label>
      <input type="date" name="to" required>
      <label>Reason</label>
      <textarea name="reason" required></textarea>
      <label>Type</label>
      <select name="leaveType" required>
        <option value="">Select</option>
        <option>Casual</option>
        <option>Sick</option>
        <option>Earned</option>
      </select>
      <button type="submit">Submit Leave</button>
    </form>

    <!-- Leave History Table -->
    <h3>Your Leave History</h3>
    <table>
      <tr>
        <th>From</th>
        <th>To</th>
        <th>Type</th>
        <th>Reason</th>
        <th>Status</th>
      </tr>
      {% for lr in leaves %}
      <tr>
        <td>{{ lr.from_date }}</td>
        <td>{{ lr.to_date }}</td>
        <td>{{ lr.leave_type }}</td>
        <td>{{ lr.reason }}</td>
        <td class="status-{{ lr.status|lower|replace(' ', '-') }}">{{ lr.status }}</td>
      </tr>
      {% endfor %}
    </table>

    <p><a href="{{ url_for('logout') }}">Logout</a></p>
  </div>
</body>
</html>
